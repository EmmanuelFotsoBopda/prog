#!/usr/bin/env python
# coding: utf-8

# In[1]:


from fastapi import APIRouter, HTTPException
from schema import User, UserCreate
from user_store import UserStore

router = APIRouter()
# Initialize the store with an SQLite database file [cite: 843, 844]
store = UserStore("users.db")

@router.get("/", response_model=list[User])
def get_users():
    # Fetch all users from the database [cite: 845, 846, 848]
    return store.load()

@router.post("/", response_model=User)
def create_user(user_in: UserCreate):
    # Save a new user and retrieve the assigned ID [cite: 856, 857, 858]
    new_id = store.save(user_in.dict())
    return {"id": new_id, **user_in.dict()}

@router.get("/{user_id}", response_model=User)
def get_user_by_id(user_id: int):
    # Retrieve specific user data via ID [cite: 810]
    user = store.find_by_id(user_id)
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    return user

@router.put("/{user_id}", response_model=User)
def update_user(user_id: int, user_update: UserCreate):
    # Extension: Endpoint for updating user data [cite: 867, 869]
    if store.update_user(user_id, user_update.dict()):
        return {"id": user_id, **user_update.dict()}
    raise HTTPException(status_code=404, detail="User not found")

@router.delete("/{user_id}")
def delete_user(user_id: int):
    # Extension: Endpoint for removing a user [cite: 867, 871]
    if store.delete_user(user_id):
        return {"message": "User deleted successfully"}
    raise HTTPException(status_code=404, detail="User not found")


# In[ ]:




